<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha256-AbA177XfpSnFEvgpYu1jMygiLabzPCJCRIBtR5jGc0k=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.13.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="半年前退坑的我大概也想不到终于有一天我会遗忘这些基础技艺并且会重返$\text{Rendering}$">
<meta property="og:type" content="article">
<meta property="og:title" content="A Recap on Volumetric Path Tracing">
<meta property="og:url" content="http://example.com/2023/10/31/VPT-Recap/index.html">
<meta property="og:site_name" content="&quot;The World&quot; of CLV">
<meta property="og:description" content="半年前退坑的我大概也想不到终于有一天我会遗忘这些基础技艺并且会重返$\text{Rendering}$">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2023-10-31T15:53:22.000Z">
<meta property="article:modified_time" content="2023-11-03T02:45:40.053Z">
<meta property="article:author" content="CLV">
<meta property="article:tag" content="Rendering">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/2023/10/31/VPT-Recap/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"http://example.com/2023/10/31/VPT-Recap/","path":"2023/10/31/VPT-Recap/","title":"A Recap on Volumetric Path Tracing"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>A Recap on Volumetric Path Tracing | "The World" of CLV</title>
  






  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link href="https://cdn.bootcss.com/KaTeX/0.11.1/katex.min.css" rel="stylesheet" /></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">"The World" of CLV</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-guestbook"><a href="/guestbook/" rel="section"><i class="comment fa-fw"></i>guestbook</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="user fa-fw"></i>About</a></li><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="home fa-fw"></i>Home</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#text-0-%E9%97%B2%E8%AF%9D%EF%BC%9A%E9%87%8D%E6%8B%BEVolumetric-Rendering%E7%9A%84%E4%B8%80%E4%BA%9B%E7%A2%8E%E7%A2%8E%E5%BF%B5"><span class="nav-number">1.</span> <span class="nav-text">$\text{0. 闲话：重拾Volumetric Rendering的一些碎碎念}$</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#text-1-%E5%85%89%E4%BC%A0%E8%BE%93%E7%9A%84%E7%AE%97%E5%AD%90%E8%A1%A8%E8%BF%B0"><span class="nav-number">2.</span> <span class="nav-text">$\text{1. 光传输的算子表述}$</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#text-1-1-%E5%85%89%E7%BA%BF%E7%A9%BA%E9%97%B4"><span class="nav-number">2.1.</span> <span class="nav-text">$\text{1.1. 光线空间}$</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#text-1-2-%E9%80%9A%E9%87%8F%E6%B5%8B%E5%BA%A6"><span class="nav-number">2.2.</span> <span class="nav-text">$\text{1.2. 通量测度}$</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#text-1-3-%E5%85%89%E7%BA%BF%E7%A9%BA%E9%97%B4%E7%9A%84%E5%87%BD%E6%95%B0"><span class="nav-number">2.3.</span> <span class="nav-text">$\text{1.3. 光线空间的函数}$</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#text-1-4-%E6%95%A3%E5%B0%84%E4%B8%8E%E4%BC%A0%E6%92%AD%E7%AE%97%E5%AD%90"><span class="nav-number">2.4.</span> <span class="nav-text">$\text{1.4. 散射与传播算子}$</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#text-1-5-%E4%BC%A0%E6%84%9F%E5%99%A8%E5%92%8C%E6%B5%8B%E9%87%8F%E6%96%B9%E7%A8%8B"><span class="nav-number">2.5.</span> <span class="nav-text">$\text{1.5. 传感器和测量方程}$</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#text-1-6-%E9%80%9A%E8%BF%87%E4%BC%B4%E9%9A%8F%E7%AE%97%E5%AD%90%E7%9A%84%E9%87%8D%E8%A6%81%E5%BA%A6%E4%BC%A0%E8%BE%93"><span class="nav-number">2.6.</span> <span class="nav-text">$\text{1.6. 通过伴随算子的重要度传输}$</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#text-2-%E4%BD%93%E7%A7%AF%E6%B8%B2%E6%9F%93%E7%9A%84%E7%AE%97%E5%AD%90%E8%A1%A8%E8%BF%B0"><span class="nav-number">3.</span> <span class="nav-text">$\text{2. 体积渲染的算子表述}$</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#text-2-1-Recap-%E4%BD%93%E7%A7%AF%E8%BE%90%E5%B0%84%E4%BC%A0%E8%BE%93"><span class="nav-number">3.1.</span> <span class="nav-text">$\text{2.1. Recap: 体积辐射传输}$</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#text-2-2-%E8%B7%AF%E5%BE%84%E7%A9%BA%E9%97%B4"><span class="nav-number">3.2.</span> <span class="nav-text">$\text{2.2. 路径空间}$</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#text-2-3-%E7%AE%97%E5%AD%90%E8%A1%A8%E8%BF%B0"><span class="nav-number">3.3.</span> <span class="nav-text">$\text{2.3. 算子表述}$</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">CLV</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">38</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/CreeperLordVader-Iclucia-Ashina" class="github-corner" title="Fork me on GitHub!" aria-label="Fork me on GitHub!" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/10/31/VPT-Recap/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="CLV">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content=""The World" of CLV">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="A Recap on Volumetric Path Tracing | "The World" of CLV">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          A Recap on Volumetric Path Tracing
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-10-31 23:53:22" itemprop="dateCreated datePublished" datetime="2023-10-31T23:53:22+08:00">2023-10-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-11-03 10:45:40" itemprop="dateModified" datetime="2023-11-03T10:45:40+08:00">2023-11-03</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>半年前退坑的我大概也想不到终于有一天我会遗忘这些基础技艺并且会重返$\text{Rendering}$</p>
<span id="more"></span>

<h1 id="text-0-闲话：重拾Volumetric-Rendering的一些碎碎念"><a href="#text-0-闲话：重拾Volumetric-Rendering的一些碎碎念" class="headerlink" title="$\text{0. 闲话：重拾Volumetric Rendering的一些碎碎念}$"></a>$\text{0. 闲话：重拾Volumetric Rendering的一些碎碎念}$</h1><p>这学期选了图形学课，自然而然也要准备大作业。我的想法自然是结合曾经学过的那些东西，为自己的$\text{Rendering}$之路画上一个句号。这其中就包括那个我没有爬上去的门槛——双向路径追踪，半年前彻底地读了$\text{Veach}$写的理论与实现，但是由于各种原因，最后自己并没有实现。</p>
<p>考虑到双向路径追踪其实做的是对路径空间的操作，在这个理论框架下体积渲染和表面渲染是可以统一的，所以这个学期我最终考虑实现双向的体积路径追踪，一方面填上$\text{BDPT}$这个坑，另一方面也把学过的体积路径追踪集成进来，不过目前来看，这个目标真的遥遥无期。。。</p>
<p>到现在，如果在中文互联网上搜索“体渲染”这个关键词，自然会搜出一大堆$\text{NeRF}$相关的讲解，然而$\text{NeRF}$所谓的“体渲染”堪称粗糙，在这个语境下作出了大量简化并且散射也直接被忽略了。。。这样自然也就略去了参与介质的很多有趣的光学性质，多少还是很遗憾。<del>这种体渲染能叫体渲染吗（暴论）</del></p>
<p>图形学老师在课上总是说对于图形学这是个改朝换代的时刻，但在这个时间点重拾这些传统技术仍然有意义。几天前一个群友凭借对于离线渲染的深刻理解找到了对口的工作，替他开心的同时我也非常振奋，毕竟技术只有能不能解决问题之分，只要学得好基础足够扎实总归是有出路的，更何况$\text{LuisaCompute}$让我意识到哪怕是这些所谓“过时”的技术也有从另一个角度去深入探索重新认识的必要，编写高性能的图形系统从来不是容易的事情，永远需要扎实的基础。再退一万步说，重新认识这些基础对于从$\text{AI}$角度去优化认识也会有帮助。</p>
<p>直到现在我还是非常佩服蒋陈凡夫老师做图形学的理念：不会为了欺骗眼睛而使用没有物理原理的$\text{Hack}$，对物理原理尽可能的尊重。一个小插曲是，在上个学期做原子物理大作业的时候我了解到了计算物理中“路径积分”的概念，和图形学中的路径积分有着高度的相似性，很亲切，多少也算是对蒋陈凡夫老师“用计算物理的想法做图形学”的一种回应（虽然他本人是做模拟的。。。不过张心欣说从业图形学的基本要求就是得把几何渲染模拟都融汇贯通，怎么想这种思路都是适用的）。回顾以往对于体积渲染以及路径追踪的学习发现有些地方并没有理解透彻，也希望自己这一次能够完全吃透这一方面，搞懂所有的细节并且最终实现自己这学期$\text{Rendering}$最后的目标，到此也只不过是勉强入门，但是已经够了。</p>
<h1 id="text-1-光传输的算子表述"><a href="#text-1-光传输的算子表述" class="headerlink" title="$\text{1. 光传输的算子表述}$"></a>$\text{1. 光传输的算子表述}$</h1><p>在初读$\text{A Null-Scattering Path Integral Formulation of Light Transport}$时，这篇论文里的形式化表述非常让我恼火<del>写的什么玩意儿</del>。</p>
<p>现在再来看的时候发现这篇神棍文默认你读过$\text{Veach}$的博士论文，因为太过有名这里就不说叫啥名字了<del>相信能点开这篇文章的人不会一无所知</del>，并且采用了那里面的形式化表述。所以首先得回去阅读这篇开山之作对此有一个完全的理解。</p>
<p>一个小插曲是之前读的$\text{BDPT}$那篇文章其实是$\text{Veach}$的论文的<strong>其中一章</strong>，不得不佩服上古时代的肝帝，那些年头的人真的是在拿应用数学对待$\text{Rendering}$。</p>
<p>所以为了方便后面的学习，在这里好好学习一下$\text{Veach}$中的算子表述。</p>
<h2 id="text-1-1-光线空间"><a href="#text-1-1-光线空间" class="headerlink" title="$\text{1.1. 光线空间}$"></a>$\text{1.1. 光线空间}$</h2><p>在基于辐射度学的渲染框架中，我们认为$\text{Radiance}$沿着光线传播，最终形成稳定分布的光场，而实际上$\text{Radiance}$（以下用中文统称为辐射度）这个物理量可以被看成是光路的函数。实际上光路还可以承载很多的物理量以及数学量，为了方便表述，我们首先形式化地定义光路的空间。</p>
<p>定义光线空间$\mathscr{R&#x3D;M}\times \mathscr{S^2}$，其中$\mathscr{M}$为整个场景的表面（这篇文章中尚未考虑到参与介质），$\mathscr{S}$则是球面，这还是非常好理解的，于是一条光线就可以定义为$\bold{r}(\bold{x}, \omega)$，一个表面的点和一个方向。</p>
<p>除此以外，也可以有其他的表示，例如我们也可以定义这样的路径空间:</p>
<p>$$\mathscr{R&#x3D;M}^2$$</p>
<p>这样就是用光线的起点和终点来表示。</p>
<h2 id="text-1-2-通量测度"><a href="#text-1-2-通量测度" class="headerlink" title="$\text{1.2. 通量测度}$"></a>$\text{1.2. 通量测度}$</h2><p>接下来我们定义空间$\mathscr{R}$上的测度$\mu$,这被称为<strong>通量测度</strong>,这个自然就非常直观，就是面积的测度乘上立体角的测度<del>虽然背后的数学严谨性我不清楚，但是谁爱关心谁关心去</del>。</p>
<p>$$d\mu(\bold{r}) &#x3D; dA(\bold{x})d\sigma_\bold{x}^{\perp}(\omega)$$</p>
<p>于是我们就可以在这个框架下定义辐射度，当然这是辐射度的的定义，但是我们有了一个紧凑的表示</p>
<p>$$L(\bold{r}) &#x3D; \frac{d\Phi(\bold{r})}{d\mu(\bold{r})}$$</p>
<p>回想上面说的，光线空间也可以用$\mathscr{M}^2$进行表示，在这种情况下，通量测度就定义为</p>
<p>$$d\mu(\bold{r}(\bold{x}, \bold{y})) &#x3D; V(\bold{x}, \bold{y})\frac{\cos(\theta_\bold{x})\cos(\theta_\bold{y})}{||\bold{x}-\bold{y}||^2}dA(\bold{x})dA(\bold{y})$$</p>
<p>这也就是我们经常在路径追踪代码中看到的测度转换的细节。</p>
<h2 id="text-1-3-光线空间的函数"><a href="#text-1-3-光线空间的函数" class="headerlink" title="$\text{1.3. 光线空间的函数}$"></a>$\text{1.3. 光线空间的函数}$</h2><p>这个没啥好说的，我们可以在空间$\mathscr{R}$上定义函数，例如辐射度$L(\bold{r})$，后面还会引入重要度$W(\bold{r})$。</p>
<p>这些自然还可以定义其范数，我们不会像数学系的那些同学们一样追求各种稀奇古怪的反例，我们只考虑对于某个给定的$p$范数有界的那些函数构成的函数空间$L_p(\mathscr{R})$。可以证明<del>我不会</del>，这个空间是完备的（也就是说所有的柯西列都收敛），因此是一个巴拿赫空间。这个函数空间上自然还可以定义内积等等概念。</p>
<p><del>好吧，我承认上面这些扯淡都是为了强行拔高本文的姿势水平</del></p>
<h2 id="text-1-4-散射与传播算子"><a href="#text-1-4-散射与传播算子" class="headerlink" title="$\text{1.4. 散射与传播算子}$"></a>$\text{1.4. 散射与传播算子}$</h2><p>函数空间的存在允许我们对于光线定义物理量了，接下来要操作这些物理量自然就要定义函数空间上的算子。</p>
<p><strong>散射算子</strong>。定义如下算子$\bold{K}$为散射算子：</p>
<p>$$(\bold{K}h)(\bold{x}, \omega_o) &#x3D; \int_{\mathscr{S}^2}f_s(\bold{x},\omega_i\rightarrow \omega_o)h(\bold{r})d\sigma_\bold{x}^\perp(\omega_i)$$</p>
<p>当然，$\text{Veach}$的这篇文章里只考虑了表面渲染，因此只需要在同一个点对于不同的立体角积分。</p>
<p>于是这样我们就可以用$L_o &#x3D; \bold{K}L_i$这样的式子十分紧凑地表达光的散射。</p>
<p><strong>传播算子</strong>。$\text{Veach}$的论文里用了一段来形式化：</p>
<p>首先定义$\bold{x}_\mathscr{M}(\bold{r}(\bold{x},\omega))$为沿着$\bold{x}$点$\omega$方向出发第一次遇到的表面$\mathscr{M}$方向上的点，当然如果遇不到那就是没定义。原文把这个定义也形式化了但是我觉得真没那个必要。</p>
<p>然后可以定义传播算子$\bold{G}$如下：</p>
<p>$$(\bold{G}h)(\bold{x},\omega)&#x3D;h(\bold{x}_\mathscr{M}(\bold{x},\omega), -\omega)$$</p>
<p>当然，这个算子也很好理解，就是描述了物理量从一个点传播到另一个点，在体渲染中这个算子还可以把衰减项也考虑进来。</p>
<p>这些定义并不能算是$\text{Veach}$的原创，$\text{Arvo}$在$1995$年就提出过类似的记号，和$\text{Veach}$的略有不同。$\text{Veach}$说这种定义的好处在于，当$f_s$是对称函数的时候，两个算子都是自伴算子，而在$\text{Arvo}$的定义中没有这种好性质，因此他不得不引入另一个算子$\bold{H}$,考虑$\bold{H}$以后就是等价的的定义了。</p>
<p>算子自伴意味着如果我们把光路逆过来也会得到相同的物理量。</p>
<p>在上述两个算子的基础上就可以定义<strong>传输算子</strong></p>
<p>$$\bold{T}&#x3D;\bold{K}\bold{G}$$</p>
<p>如果把场景中的所有发光体发出的辐射度定义为函数$L_e$，我们熟悉的表面渲染的渲染方程就可以在上述记号下简洁地写为算子方程</p>
<p>$$L &#x3D; L_e+\bold{T}L$$</p>
<p>更多分析学的讨论这里就不继续了，这个方程并不总是有解的，我们只需要考虑有解的情形就行——实际上，对于物理世界里正常的场景，都是有解的，这个时候我们可以定义其解算子$\bold{S}$为</p>
<p>$$\bold{S}&#x3D;(\bold{I}-\bold{T})^{-1}$$</p>
<p>于是就有$L&#x3D;\bold{S}L_e$，$L$被称为平衡辐射度函数。</p>
<h2 id="text-1-5-传感器和测量方程"><a href="#text-1-5-传感器和测量方程" class="headerlink" title="$\text{1.5. 传感器和测量方程}$"></a>$\text{1.5. 传感器和测量方程}$</h2><p>我们输出图片的方式自然是像素，但是拿像素来形式化显然不够本质，毕竟我们可以用不同的形式来表述一张图片。如果使用光线追踪&#x2F;光栅化等等方法，那么我们自然可以把图像表示为一个颜色序列表示每个像素的颜色。而如果我们使用有限元，那么输出图片就是一个系数组合表示每个基函数对应的系数。当然，我们渲染出来的东西甚至也可以不是颜色。</p>
<p>更一般的，对于线性的传感器，我们可以定义“响应函数”如下</p>
<p>$$W_e(\bold{x}, \omega) &#x3D; \frac{dS(\bold{x}, \omega)}{d\Phi(\bold{x}, \omega)}$$</p>
<p>$S$是传感器观测到的物理量，在图形学中，$W_e$被称为<strong>重要度函数</strong>，$W_e$大多数时候都是$0$，因为我们考虑的是正常的相机，大部分时候只关注一个平面上收到的辐射通量。这里的$W_e$考虑了你可能在相机上玩的所有花活儿——透镜系统，滤波器等等都在这个框架之下。</p>
<p>如何描述一张图片呢？这就是<strong>测量方程</strong>：</p>
<p>$$I(\bold{x},\omega)&#x3D;\int_\mathscr{R}W_e(\bold{r})L_i(\bold{r})d\mu(\bold{r})$$</p>
<p>也可以通过点积紧凑地写为</p>
<p>$$I&#x3D;&lt;W_e, L_i&gt;$$</p>
<p>这是一般性的方程，对整个光线空间积分，实际上因为很多情况下我们只关注胶片上的图片长什么样子，只需要算出胶片上的$I$即可。</p>
<p>$L_i$和$L$的关系可以通过传输算子联系起来（让辐射度传输到相机上），于是我们可以把测量方程写为</p>
<p>$$I&#x3D;&lt;W_e, L_i&gt;&#x3D;&lt;W_e, \bold{G}L&gt;&#x3D;&lt;W_e, \bold{GS}L_e&gt;$$</p>
<h2 id="text-1-6-通过伴随算子的重要度传输"><a href="#text-1-6-通过伴随算子的重要度传输" class="headerlink" title="$\text{1.6. 通过伴随算子的重要度传输}$"></a>$\text{1.6. 通过伴随算子的重要度传输}$</h2><p>回忆一下，对于一个算子$\bold{H}$，我们可以定义其伴随算子$\bold{H}^*$为</p>
<p>$$&lt;\bold{H}^*f, g&gt;&#x3D;&lt;f, \bold{H}g&gt;$$</p>
<p>使用伴随算子的记号，又可以把测量方程写为</p>
<p>$$I&#x3D;&lt;(\bold{GS})^*W_e, L_e&gt;$$</p>
<p>当然，实际使用我们还是得把算子展开，这也就需要把$\bold{G}$和$\bold{K}$的伴随算子写出来，$\bold{G}$在任何场景下都是自伴的，但是$\bold{K}$仅在场景中$\text{BSDF}$均对称时才是自伴的，我们首先定义伴随的$\text{BSDF}$。</p>
<p>$$f_s^*(\bold{x}, \omega_o\rightarrow \omega_i)&#x3D;f_s(\bold{x}, \omega_i\rightarrow \omega_o)$$</p>
<p>然后我们可以定义$\bold{K}$的伴随算子</p>
<p>$$(\bold{K}^<em>h)(\bold{x}, \omega_o)&#x3D;\int_{\mathscr{S}^2}f_s^</em>(\bold{x},\omega_i\rightarrow \omega_o)h(\bold{x}, \omega_i)d\sigma_\bold{x}^\perp(\omega_i)$$</p>
<p>然后论文里很不负责任地假设$\text{BSDF}$都是对称的。。。于是$\bold{K}$就是自伴的了。</p>
<p>在这种情况下可以证明$\bold{GS}$也是自伴算子，我们可以把测量方程里的伴随去掉，于是就有</p>
<p>$$I&#x3D;&lt;(\bold{GS})^*W_e, L_e&gt;&#x3D;&lt;\bold{GS}W_e, L_e&gt;$$</p>
<p>所以前面的讨论约等于放了一发空炮，但是这也是一个非常重要的提醒：一定要小心场景中的不对称性，对于不对称的$\text{BSDF}$要使用其伴随。这种情况并不罕见，实际上如果稍微写过一点儿表面材料就知道透明绝缘介质的折射会导致这种情况。</p>
<p>由于$\bold{GS}$是自伴的（在我们美好的假设里），这个时候优雅的对称性就允许我们跟光传输一样一样地写出重要度传输，也就是。</p>
<p>$$W&#x3D;W_e+\bold{T}W$$</p>
<p>$$W&#x3D;\bold{S}W_e$$</p>
<p>这也就是为什么很多时候我们从相机出发计算路径追踪也是对的。</p>
<p>不过$\bold{K}$不自伴也不是什么难事，将$\bold{K}$替换为$\bold{K}^*$定义$\bold{T}_W$然后把上面的$\bold{T}$替换为$\bold{T}_W$即可。</p>
<p>最后的最后，我们重新回顾四个重要的物理量，入射辐射度$L_i$，出射辐射度$L_o$，入射重要度$W_i$，出射重要度$W_e$，这四个量之间的关系可以用下面的式子表示：</p>
<p>$$L_i&#x3D;\bold{G}L_o$$</p>
<p>$$W_i&#x3D;\bold{G}W_o$$</p>
<p>$$L_o&#x3D;\bold{K}L_i$$</p>
<p>$$W_o&#x3D;\bold{K^*}W_i$$</p>
<p>对于整个场景，大多数时候我们最初始能拿到的条件就是$W_e$和$L_e$。少数时候用入射的$W_e$和$L_e$考虑则更为自然，论文里说这通常是在使用有限元法解渲染方程的时候，不过考虑到本文的目的，这里就不展开了。</p>
<p>扯句闲话就是，这一套理论和物理学与工程学中的许多问题也是相关的，很多问题和光传输也有着类似的性质，这一套框架部分也是从那些领域中来的，甚至可以追溯至上世纪七十年代的中子传输问题。<del>某种意义上可以说图形学的老祖宗还真就是计算物理</del></p>
<h1 id="text-2-体积渲染的算子表述"><a href="#text-2-体积渲染的算子表述" class="headerlink" title="$\text{2. 体积渲染的算子表述}$"></a>$\text{2. 体积渲染的算子表述}$</h1><h2 id="text-2-1-Recap-体积辐射传输"><a href="#text-2-1-Recap-体积辐射传输" class="headerlink" title="$\text{2.1. Recap: 体积辐射传输}$"></a>$\text{2.1. Recap: 体积辐射传输}$</h2><p>接下来时间快进到$2019$年$\text{null-scattering}$的论文。体积渲染相比于表面渲染的本质区别在于光线空间可以取遍整个场景，不再局限于表面。</p>
<p>体积辐射传输方程在此就不再叙述了，这些属于基础中的基础，可以参考$\text{CSE-272}$作业笔记。</p>
<p>考虑所谓的“空散射”之后，体积辐射传输方程可以写为</p>
<p>$$(\omega\cdot\nabla)L(\bold{x},\omega)&#x3D;-\bar{\mu}_tL(\bold{x},\omega)+\bar{\mu}_tL^{\bar{m}}(\bold{x},\omega)$$</p>
<p>其中 </p>
<p>$$L^{\bar{m}}(\bold{x},\omega)&#x3D;\frac{\mu_a(\bold{x})}{\bar{\mu}_t(\bold{x})}L_e^m(\bold{x},\omega)+\frac{\mu_s(\bold{x})}{\bar{\mu}<em>t(\bold{x})}\int</em>{\mathscr{S}^2}\rho_m(\bold{x},\omega’\rightarrow\omega)L(\bold{x},\omega’)d\omega’+\frac{\mu_n(\bold{x})}{\bar{\mu}_t(\bold{x})}L(\bold{x},\omega)$$</p>
<p>上式中第一项为发光项，第二项为实散射项，第三项为空散射项。</p>
<p>第一个方程还可以进一步$\text{ODE}$得到</p>
<p>$$L(\bold{x},\omega)&#x3D;\int_0^z\bar{T}(\bold{x},\bold{y})\bar{\mu}_t(\bold{y})L(\bold{y}, \omega)dy+\bar{T}(\bold{x},\bold{z})L^s(\bold{z},\omega)$$</p>
<p>$L^s$顾名思义就是散射的辐射度。在本文中，所有由于考虑空散射而造成的“假想”的物理量都有一个上划线，可以据此区分。$\bar{T}$就是考虑空散射后的传输项。</p>
<p>$$T(\bold{x},\bold{y})&#x3D;\exp(-\bar{\tau}(\bold{x},\bold{y}))&#x3D;\exp(-\int_0^y\bar{\mu}_t(\bold{x}-s\omega)ds)$$</p>
<h2 id="text-2-2-路径空间"><a href="#text-2-2-路径空间" class="headerlink" title="$\text{2.2. 路径空间}$"></a>$\text{2.2. 路径空间}$</h2><p>你当然需要注意路径空间和光线空间的区别。此外，在本文中，为了方便表达$\delta$分布，还引入了$\text{Dirac}$测度$\delta_\bold{x}$。</p>
<p>定义路径空间为$$\mathscr{P}&#x3D;\bigcup\limits_{k&#x3D;0}^\infty (\mathscr{A}\cup\mathscr{V}\cup\mathscr{V}_\delta)^k$$</p>
<p>这个非常直观，一共有三种路径节点：在表面上，在参与介质中且改变了传播方向，在参与介质中并且没有改变传播方向。</p>
<p>$$d\bar{\bold{x}}&#x3D;\prod\limits_i d\bold{x}_i$$</p>
<p>这里$d\bar{\bold{x}}$表示路径的测度，$\bold{x}_i$表示路径上的第$i$个节点，$d\bold{x}_i$则需要根据节点类型进行不同处理。</p>
<p>这里唯一较为特殊的地方大概是$\mathscr{V}_\delta$中的节点，其测度定义为</p>
<p>$$d\bold{x}<em>i&#x3D;d\delta</em>{\bold{x}^-_{i}\leftrightarrow\bold{x}^+_i}(\bold{x}_i)$$</p>
<p>这很好理解，$\text{Dirac}$测度意味着我们把积分限制在了这一个方向上。</p>
<p>接下来，为了统一介质与表面，我们引入一般化的函数，这些函数根据点的不同类型取不同的值，有了一致的函数表达以后就可以使用算子表述一统天下了。</p>
<p>定义：</p>
<p>$$G(\bold{x},\bold{y})&#x3D;\frac{D(\bold{x},\omega_{\bold{xy}})V(\bold{x},\bold{y})D(\bold{y},\omega_{\bold{yx}})}{||\bold{x}-\bold{y}||^2}$$</p>
<p>其中对于表面上的点$D(\bold{x}, \omega)&#x3D;|n(\bold{x})\cdot \omega|$而对于体积上的点$D(\bold{x}, \omega)&#x3D;1$。</p>
<p>这个$G$函数说白了就是用来将立体角测度转化为节点测度的。</p>
<p>对于表面上的点，$$L_e(\bold{x},\omega)$$就是发光的辐射度，而对于参与介质上的点，这个值还要乘上一个吸收系数$\mu_a(\bold{x})$，不过我好奇介质自己发光自己也会吸收么。。。</p>
<p>然后是一般性的散射函数（这个名字我自己起的）$\rho$，对于表面上的点，就是$\text{BSDF}$，对于参与介质上的点，就是$\text{Phase Function}$乘上散射系数（乘散射系数这真的是个写$\text{VPT}$特别容易翻车的点），而对于$\mathscr{V}_\delta$上的点，$\rho$的值是$\mu_n(\bold{x})H(\omega\cdot\omega’)$，$H$是阶跃函数。</p>
<p>使用上面的表达就可以改写体积渲染方程：</p>
<p>$$L(\bold{x},\omega)&#x3D;\int_0^z\bar{T}(\bold{x},\bold{y})L_o(\bold{y}, \omega)dy+\bar{T}(\bold{x},\bold{z})L_o(\bold{z},\omega)$$</p>
<p>$$L_o(\bold{x},\omega)&#x3D;L_e(\bold{x},\omega)+\int_{\mathscr{S}^2}\rho(\bold{x},\omega’\rightarrow\omega)L(\bold{x},\omega’)D(\bold{x},\omega’)d\omega’+\mu_n(\bold{x})L(\bold{x},\omega)$$</p>
<h2 id="text-2-3-算子表述"><a href="#text-2-3-算子表述" class="headerlink" title="$\text{2.3. 算子表述}$"></a>$\text{2.3. 算子表述}$</h2><p>这就是和$1.$类似的手法了，定义如下四个算子</p>
<p>$$(\mathbf{R}<em>\text{m}h)(\mathbf{x},\omega)&#x3D;\int</em>{\mathcal{S}^2}\int_0^z\rho(\omega,\mathbf{x},\omega^{\prime})\overline{T}(\mathbf{x},\mathbf{y})D(\mathbf{x},\omega^{\prime})h(\mathbf{y},\omega^{\prime})\mathrm{d}y\mathrm{d}\omega^{\prime}$$</p>
<p>$$(\mathbf{R_s}h)(\mathbf{x},\omega)&#x3D;\int_{\mathcal{S}^2}\rho(\omega,\mathbf{x},\omega^{\prime})\overline{T}(\mathbf{x},\mathbf{z})D(\mathbf{x},\omega^{\prime})h(\mathbf{z},\omega^{\prime})\mathrm{d}\omega^{\prime}$$</p>
<p>$$(\mathbf{N_m}h)(\mathbf{x},\omega)&#x3D;\mu_\mathbf{n}(\mathbf{x})\int_0^z\overline{T}(\mathbf{x},\mathbf{y})h(\mathbf{y},\omega)\mathrm{d}y$$</p>
<p>$$(\mathbf{N_s}h)(\mathbf{x},\omega)&#x3D;\mu_\mathbf{n}(\mathbf{x})\bar{T}(\bold{x},\bold{z})h(\mathbf{z},\omega)$$</p>
<p>于是可以定义$\mathbf{R}&#x3D;\mathbf{R_m}+\mathbf{R_s},\mathbf{N}&#x3D;\mathbf{N_m}+\mathbf{N_s} $</p>
<p>$\mathbf{R}$表示“实”，而$\mathbf{N}$表示“空”。</p>
<p>这样一来，把前面两个渲染方程中的$L$干掉，留下$L_o$，其积分方程就写成如下紧凑的算子形式</p>
<p>$$L_o&#x3D;L_e+(\mathbf{R}+\mathbf{N})L_o$$</p>
<p>同样定义测量函数，在本文中，就默认使用像素表达了。</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Rendering/" rel="tag"># Rendering</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2023/10/15/UCAS-Network-Lab-4-stp/" rel="prev" title="UCAS-Network-Lab-4-stp">
                  <i class="fa fa-chevron-left"></i> UCAS-Network-Lab-4-stp
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2023/12/16/UCAS-Network-Lab-10~12-tcp-stack/" rel="next" title="UCAS-Network-Lab-10~12-TCP Stack">
                  UCAS-Network-Lab-10~12-TCP Stack <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">CLV</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  





  





</body>
</html>
